<html>
<head>
  <style type="text/css">
    body {background:black;}
    .control_button {position:relative; z-index:999;}
    .half {width:50%;}
    .full {position:absolute; top:0; width:100%; height:100%;}
    .selected {background:green;color:white;}
  </style>
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', function(){
        // generate speed buttons
        let speeds = [0.3, 0.4, 0.5, 0.6, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1, 1.1, 1.25, 1.5, 1.75, 2];
        speedHtml = "";
        // <button id="but_sp_N" onClick="changeSpeed(N);">x N</button>
        speeds.forEach(function(speed, index, array) {
            speedHtml = speedHtml +
                "<button id=\"but_sp_" + speed + "\" onClick=\"changeSpeed(" + speed + ");\">x "+ speed + "</button>";
        });
        let speedArea = document.getElementById("speed_area");
        speedArea.innerHTML = speedHtml;

        // generate song buttons
        let songs = [];
        // songs.push(['filepath', 'button text', default speed(float), default flag]);
        // need to escape ' -> \\'
        songs.push(["./窓を開けて_vo有り.mov", "窓を開けて", 0.13]);
        songs.push(["./RollingThunder.mov", "Rolling Thunder", 0.25]);
        songs.push(["./Shiny Stellar_tux.mov", "Shiny Stellar(tux)", 0.33]);
        songs.push(["./Shiny Stellar_pdf.mov", "Shiny Stellar(pdf)", 0.15]);
        songs.push(["./What's this_5st.mov", "What's this?", 0.15]);
        songs.push(["../原曲/不完全パズル.mp3", "不完全パズル", 0.2, true]);
        songs.push(["../原曲/メルト.mp4", "メルト", 0.35]);

        // <button id="song_N" onClick="changeSong(N, 'filepath', speed);">butto text</button>
        songHtml = "";
        defaultSong = [];
        songs.forEach(function(song, index, array) {
            songHtml = songHtml +
                "<button id=\"song_" + index +  "\" " +
                "onClick=\"changeSong(" + index + ", '" + song[0].replace(/'/g, "\\'") + "', " + song[2] + ");\">" + song[1] +
                "</button>"
            if( song[3] ){
                defaultSong = index;
            }
        });
        let songArea = document.getElementById("song_area");
        songArea.innerHTML = songHtml;

        videoElement = document.querySelector("video");
        video = document.getElementById('video');
        curSpeed = 1;
        curSong = defaultSong;
	    video.addEventListener('ended',function() {
            video.classList.remove('full');
	    });
	    changeSpeed(curSpeed);
	    changeSong(curSong, songs[curSong][0], songs[curSong][2]);
    });

    function play(){
        video.classList.add('full');
        video.play();
	}
    function pause(){
        video.classList.remove('full');
        video.pause();
    }
    function changeSpeed(num){
        videoElement.playbackRate = num;
        var cur_selected_id = document.getElementById('but_sp_'+curSpeed);
        cur_selected_id.classList.remove('selected');
        var new_selected_id = document.getElementById('but_sp_'+num);
        new_selected_id.classList.add('selected');
        curSpeed = num;
    }
    function changeSong(num, path, volume){
        videoElement.src = path;
        var cur_selected_id = document.getElementById('song_'+curSong);
        cur_selected_id.classList.remove('selected');
        var new_selected_id = document.getElementById('song_'+num);
        new_selected_id.classList.add('selected');
        curSong = num;
        changeSpeed(curSpeed);
        videoElement.volume = volume;
    }
  </script>
</head>
<body>
  <button class="control_button" onClick="play();">play</button>
  <button class="control_button" onClick="pause();">pause</button><br>
  
  <div id="speed_area"></div>
  <div id="song_area"></div>
  <video id='video' class="half" type="video/webm" src="" controls></video>

</body>
</html>
